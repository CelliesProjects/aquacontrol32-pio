<!DOCTYPE html>
<html>

<head>
    <title>System Stats</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            /* Light background color */
        }

        h1 {
            text-align: center;
            color: #333;
            /* Darker heading color */
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            /* Subtle table shadow */
            background-color: white;
            /* White table background */
        }

        th,
        td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            /* Light border between rows */
        }

        th {
            background-color: #007bff;
            /* Blue header background */
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            /* Uppercase header text */
        }

        tr:hover {
            background-color: #f0f0f0;
            /* Light gray hover on rows */
        }

        #stats {
            text-align: center;
            /* Center the "Loading..." message */
            color: #777;
            /* Gray loading message */
        }
    </style>
    <script>
        async function fetchStats() {
            const response = await fetch('/api/taskstats');
            if (!response.ok) {
                console.error("Error fetching stats:", response.status, response.statusText);
                document.getElementById('stats').innerHTML = "Error fetching data.";
                return;
            }

            const csvData = await response.text();
            const rows = csvData.split('\n');

            const data = [];
            const headers = rows[0].split(',');
            for (let i = 0; i < rows.length; i++) {
                const rowData = {};
                const cells = rows[i].split(',');
                for (let j = 0; j < headers.length; j++) {
                    rowData[headers[j]] = cells[j];
                }
                if (cells.length > 1) {
                    data.push(rowData);
                }

            }

            // Sort by CPU% (descending)
            data.sort((a, b) => {
                const cpuA = parseFloat(a['CPU%']);
                const cpuB = parseFloat(b['CPU%']);
                return cpuB - cpuA;
            });


            const table = document.createElement('table');

            data.forEach(item => {
                const tr = table.insertRow();
                for (const header of headers) {
                    const td = tr.insertCell();
                    let cellValue = item[header];
                    if (header === 'CPU%') {
                        const cpuValue = parseFloat(cellValue);
                        if (!isNaN(cpuValue)) {
                            cellValue = cpuValue.toFixed(2) + "%";
                        }
                    }
                    td.textContent = cellValue;
                }
            });

            document.getElementById('stats').innerHTML = '';
            document.getElementById('stats').appendChild(table);
        }

        //setInterval(fetchStats, 1000);
        window.onload = fetchStats;
    </script>
</head>

<body>
    <h1>System Statistics</h1>
    <div id="stats">Loading...</div>
</body>

</html>